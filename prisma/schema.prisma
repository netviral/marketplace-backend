// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql" // or "mysql" or "sqlite"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  imageUrl  String?
  roles     String[]
  isActive  Boolean  @default(true)
  isBlocked Boolean  @default(false)
  isAdmin   Boolean  @default(false)
  phone     String?
  address   String?
  passwordHash   String?
  apiKey   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // relations
  reviews       Review[]
  ownedVendors  Vendor[]  @relation("VendorOwners")
  memberVendors Vendor[]  @relation("VendorMembers")
  orders        Order[]
  wishlist      Listing[] @relation("UserWishList")
}

model Vendor {
  id           String   @id @default(uuid())
  name         String
  logo         String   @default("")
  description  String
  contactEmail String
  contactPhone String
  categories   String[]
  isActive     Boolean  @default(true)
  isVerified   Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // relations
  listings Listing[]
  owners   User[]    @relation("VendorOwners") // owners (many-to-many to User)
  members  User[]    @relation("VendorMembers") // members (many-to-many to User)
}

model Listing {
  id            String        @id @default(uuid())
  name          String
  images        String[]
  description   String
  type          ListingType
  inventoryType InventoryType
  availableQty  Int?
  isAvailable   Boolean?
  price         Decimal?      @db.Decimal(10, 2)
  variants      String[]      @default([])

  vendorId String
  vendor   Vendor @relation(fields: [vendorId], references: [id])

  tags         Tag[]    @relation("ListingTags")
  reviews      Review[]
  orders       Order[]
  wishlistedBy User[]   @relation("UserWishList")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([vendorId, name])
  @@index([vendorId])
}

model Tag {
  id       String    @id @default(uuid())
  name     String    @unique
  listings Listing[] @relation("ListingTags")
}

model Review {
  id       String   @id @default(uuid())
  rating   Int
  comments String[] @default([])

  userId String
  user   User   @relation(fields: [userId], references: [id])

  listingId String
  listing   Listing @relation(fields: [listingId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([listingId, userId])
  @@index([listingId])
  @@index([userId])
}

model Order {
  id        String @id @default(uuid())
  userId    String
  listingId String

  user    User    @relation(fields: [userId], references: [id])
  listing Listing @relation(fields: [listingId], references: [id])

  quantity   Int         @default(1)
  totalPrice Decimal     @db.Decimal(10, 2)
  status     OrderStatus @default(PENDING)

  notes String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([listingId])
}

enum ListingType {
  PRODUCT
  SERVICE
}

enum InventoryType {
  STOCK
  ON_DEMAND
}

enum OrderStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}
